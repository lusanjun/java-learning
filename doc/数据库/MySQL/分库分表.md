## 分库分表

### 1. 分库分表概述

#### 1.1 分库分表原因

- 数据量过大，单表1000万或20G以上
- 常规的数据库优化已解决不了性能问题，如索引、优化查询sql
- IO瓶颈：磁盘IO、网络IO，CPU瓶颈：聚合查询、连接数过多

### 2. 分库分表方式

#### 2.1 垂直分

分库：

- 以表为依据，根据业务将不同表分到不同的数据库中。
- 按业务对数据分级管理、维护、监控、扩展。在高并发下，提高磁盘IO和连接数。

分表：

- 以字段为依据，根据字段属性不同拆分到不同表中。
- 把不常用的字段单独放一张表，冷热数据隔离。
- 把text、blob等大字段拆分到附表，避免过渡消耗IO资源，两表互不影响。

#### 2.2 水平分

分库：

- 一个库数据拆分到多个库。
- 根据id节点取模，或根据范围截取（1-100w，100w-200w）。
- 解决高并发的性能瓶颈，提高系统稳定性和可用性。

分表：

- 一个表的数据拆分到多个表，可以在同一个库。
- 根据时间，每月、日一表，或id分表。
- 避免IO争抢并减少锁表几率。

### 3. 分库分表策略

分库后问题：

- 分布式事务一致性问题
- 跨节点关联查询
- 主键id避免重复，分布式id

分库分表工具：

- Sharding-sphere
- mycat