## 运算



### 1. 自增自减

自增（ ++）自减（--）不是原子性计算操作。

```java
 int i = 2; int j = i++;
```

拆分运算过程为，i = i + 1 = 3；j = i = 3

#### 1.1 前缀与后缀

前缀式（++i,--i）与后缀式（i++,--i）的真正区别：

在 Java 中，运算是从左往右计算的，并且按照运算符的优先级，逐一计算出表达式的值，并用这个值参与下一个表达式的运算，如：1+2+3，其实是先计算出 1+2 表达式的值为3，再参与下一个表达式的运算 (1+2)+3，即 3+3。

a++ 表达式计算结果是 a 的旧值（加1前的值）。++a 表达式的计算结果 a 加1后的值。

自增的前缀式与后缀式的本质区别是：表达式的值（运算结果） 是加1前的变量的值还是加1后的变量的值（自减也是如此）。

#### 1.2 不是线程安全的

自增、自减运算符本质上不是一个计算操作，而是两个计算操作。以 a++ 为例，这个运算将会编译器解析成： a=a+1 ，即包含两个单目运算符（+、=）,一个单目运算符的计算操作可以看作是一个原子性操作。 a++ 的步骤可以描述成 ：先取a加1，将结果存储在临时空间；将结果赋给a。所以，自增自减运算符包含两个操作：一个加1（减1）的操作和一个赋值的操作。

#### 1.3 贪心原则

a+++b 的运算结果是 (a++)+b

```java
 int a = 1; 
 int b = 1;
 int c = a+++b;
 System.out.println(a); //2
 System.out.println(b); //1
 System.out.println(c); //2
```

贪心规则：编译器会尽可能多地结合有效的符号。最主要应用在分析String字符串。

```java
 //以"\"转义字符为例
 String s1="\171";
 System.out.println(s1+":"+s1.length()); //y:1
 String s2="\1717";
 System.out.println(s2+":"+s2.length()); //y7:2
 String s3="\17171";
 System.out.println(s3+":"+s3.length()); //y71:3
```

八进制转义字符中，格式为 \ddd，d的范围是0-7，超出范围则不算作转义字符。上述代码中，171以后的算作字符串的其他字符。

### 2. 位运算

位运算，应用于 int，long，short，byte ，char 等类型。位运算是基于机器直接运算的，效率最高。

举例，a 和 b

```java
 int a = 60; // 0011 1100
 int b = 13; // 0000 1101
```

| 运算符 | 描述         | 规则                        | 运算结果      | 二进制结果 |
| ------ | ------------ | --------------------------- | ------------- | ---------- |
| &      | 与           | 都为1，则为1，其余全为0     | 60 &13 = 12   | 0000 1100  |
| \|     | 或           | 有一个为1，则为1，其余全为0 | 60 \| 13 = 61 | 0011 1101  |
| ^      | 异或         | 相同为0，不同为1            | 60 ^ 13 = 49  | 0011 0001  |
| ~      | 取反（非）   | 0变成1，1变成0              | ~ a = -61     | 1100 0011  |
| <<     | 左移位       | 按照位数，向左移动，低位补0 | a << 2 = 240  | 1111 0000  |
| >>     | 右移位       | 按照位数，向右移动，高位补0 | a >> 2 = 15   | 0000 1111  |
| >>>    | 无符号右移位 | 和右移位一样，正负高位均为0 | a >>> 2 = 15  | 0000 1111  |

### 3. 逻辑运算

#### 3.1 逻辑运算符

&&与运算，当且仅当两个操作都为真，条件才为真。

||或运算，两个操作任一为真，条件即为真。

！非运算，操作的反逻辑状态。

#### 3.2 短路运算符

当使用与运算，第一个操作判断为 false，条件即为 false，第二个操作就不用判断。

```java
int a =3;
if((a<2) && (++a>3)){
	System.out.println(a); //不执行
}
System.out.println(a); //3
```

a < 2 已经是 false ，就不会执行后面的 ++a 操作。