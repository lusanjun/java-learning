## 网络

### 1.OSGI七层网络模型

- 物理层：定义物理设备标准，传输比特流，做法是模数转换和数模转换，这一层的数据叫做比特。
- 数据链路层：对数据包中的MAC地址进行解析和封装，这一层的数据叫做帧。
- 网络层：对数据包中的IP地址进行封装和解析，这一层的数据叫做数据包。
- 传输层：定义传输数据的协议和端口号，用于数据的分段、传输和重组。这一层的协议有TCP和UDP等。
- 会话层：登录验证、断点续传、数据粘包和分包等。
- 表示层：对接收的数据进行解释、加密、解密、压缩、解压缩等。把计算机识别的内容转换成人能够识别的内容。
- 应用层：基于网络构建具体应用。

### 2.TCP/IP

#### 2.1 TCP/IP四层网络模型

TCP/IP不是指TCP和IP两个协议，而是指整个互联网的TCP/IP协议簇。

- 网络接口层：定义主机间网络连通的协议，包括Echernet、FDDI、ATM等通信协议。
- 网络层：用于数据的传输、路由及地址的解析，以保障主机可以把数据发送给任何网络上的目标，数据经过网络传输，发送的顺序和到达的顺序可能发生变化。网络层使用IP和地址解析协议（ARP）。
- 传输层：使源端和目的端机器上的对等实体可以基于会话相互通信。定义了两个端到端的协议TCP和UDP。
- 应用层：负载具体应用协议的定义，包括FTP、SMTP、DNS、NNTP、HTTP等。

#### 2.2 TCP与UDP区别

TCP，传输控制协议，是面向连接的通信协议，传输数据前，在发送端和接收端建立逻辑连接，再传输数据。可靠性高，多路复用。应用如下载文件、浏览网页等。

UDP，用户数据报送协议，面向无连接的协议，传输数据时，不要建立连接，不管对方服务是否启动，直接将数据、数据源和目的地封装在数据包中，直接发送。传输速度块，但数据容易丢失，应用如视频会议、直播等。

#### 2.2 TCP三次握手

建立连接时，需要三次握手

1. 客户端发送SYN报文给服务端，进入SYN_SEND状态。
2. 服务端收到SYN报文，回应一个syn和ack报文，进入SYN_RECV状态。
3. 客户端收到服务端的SYN报文，回应一个ACK报文，进入Established状态。

![TCP三次握手](https://gitee.com/lusanjun/blog-img/raw/master/TCP3.png)

#### 2.3 TCP四次挥手

断开连接时，需要四次挥手

1. 客户端发送一个 fin，用来关闭客户端到服务端的数据传输
2. 服务端收到这个fin，返回一个ack，确认序号为收到的序号加1
3. 服务端关闭与客户端的连接，发送一个fin给客户端
4. 客户端发送ack报文确认，并将确认序号为收到的序号加1

![TCP四次挥手](https://gitee.com/lusanjun/blog-img/raw/master/TCP4.png)

### 3. HTTP

#### 3.1 HTTP

HTTP是无状态的协议，无状态指在客户端和服务端不需要建立持久的连接，在一个客户端向服务端发出请求且服务器收到请求并返回响应后，本次通信结束。http连接被关闭。服务器不保留连接的相关信息。

HTTP遵循请求（Request）/响应（Response）模型。

#### 3.2 传输流程

1. 地址解析：通过域名系统DNS解析服务器域名获得主机的IP地址。
2. 封装HTTP数据包：解析协议名、主机名、端口、对象路径等并结合本机自己的信息封装成一个HTTP请求数据包。
3. 封装TCP包：将HTTP请求数据包进一步封装成TCP数据包。
4. 建立TCP连接：基于TCP的三次握手建立TCP连接。
5. 客户端发送请求：建立连接后，客户端发送一个请求给服务器。
6. 服务器响应：服务器在接收到请求后，处理数据，向客户端返回响应信息。
7. 服务器关闭TCP连接：服务器返回响应数据后关闭TCP连接，但如果浏览器在消息头加入了`Connection:keep-alive`，则TCP连接在请求响应数据发送后仍保存连接状态，下一次请求可以继续使用相同的连接，减少了响应时间，节约网络带宽和系统资源。

#### 3.3 HTTPS

HTTP协议运行在TCP之上，所有传输的内容都是明文的，客户端和服务端无法验证对方身份。HTTPS在HTTP基础上加入SSL协议，SSL靠证书验证服务器的身份，并对通信数据进行加密，保障数据安全。端口一般是443。

加密过程：

1. 发起请求：客户端通过TCP和服务器建立连接后，发出一个请求证书的消息给服务器，请求消息包含自己可实现的算法列表和其他需要的消息。
2. 证书返回：服务端返回证书，包含服务器信息、域名、申请证书的公司、公钥、数据加密算法等。
3. 证书验证：客户端收到证书，判断证书签发机构是否正确，并使用该签发机构的公钥确认签名是否有效。证书有效，生成对称密钥，并使用公钥将对称密钥加密。
4. 密钥交换：客户端将加密后的对称密钥发送给服务器，服务器在接收到对称密钥后使用私钥解密。
5. 数据传输：客户端和服务端基于对称加密，对数据加密后在网络上传输。

#### 3.4 URI、URL、URN

URI（Uniform Resource Identifier）统一资源标志符，资源抽象的定义，不管用什么方法表示能定位一个资源，就叫URI。

URL（Uniform Resource Locator）统一资源定位符，一种具体的URI，用地址定位。

URN（Uniform Resource Name）统一资源名称符，一种具体的URI，用名称定位。

URI只是一种定义规范，URL和URN都是具体的实现方式，